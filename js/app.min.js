var app=angular.module("WidgetSpa",["ui.router","ngAnimate","ngSanitize","ngCookies"]);app.constant("API_URL","http://spa.tglrw.com:4000"),app.run(["$rootScope",function(a){}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("dashboard",{url:"/",templateUrl:"partials/pages/dashboard.html",controller:"DashboardCtrl"}).state("users",{url:"/users",templateUrl:"partials/pages/users.html",controller:"UsersCtrl"}).state("userDetails",{url:"/users/:id",templateUrl:"partials/pages/user-details.html",controller:"UserDetailsCtrl"}).state("widgets",{url:"/widgets",templateUrl:"partials/pages/widgets.html",controller:"WidgetsCtrl"}).state("widgetDetails",{url:"/widgets/:id",templateUrl:"partials/pages/widget-details.html",controller:"WidgetDetailsCtrl"}),b.otherwise("/")}]),app.factory("_users",["$http","API_URL",function(a,b){var c={};return c.getAllUsers=function(){return a.get(b+"/users").then(function(a){return a.data})},c.getUser=function(c){return a.get(b+"/users/"+c).then(function(a){return a.data})},c}]),app.factory("_widgets",["$http","API_URL",function(a,b){var c={};return c.getAllWidgets=function(){return a.get(b+"/widgets").then(function(a){return a.data})},c.getWidget=function(c){return a.get(b+"/widgets/"+c).then(function(a){return a.data})},c.createWidget=function(c){return a.post(b+"/widgets",c).then(function(a){return a.data})},c.editWidget=function(c,d){return a.put(b+"/widgets/"+c,d).then(function(a){return a.data})},c.getColorOptions=function(){return a.get(b+"/widgets").then(function(a){var b=[];return a.data&&(angular.forEach(a.data,function(a){-1==b.indexOf(a.color)&&b.push(a.color)}),b=b.sort()),b})},c}]),app.controller("MainCtrl",["$scope","$cookieStore",function(a,b){var c=new Date;a.year=c.getFullYear();var d=992;a.getWidth=function(){return window.innerWidth},a.$watch(a.getWidth,function(c,e){c>=d?angular.isDefined(b.get("toggle"))?a.toggle=b.get("toggle")?!0:!1:a.toggle=!0:a.toggle=!1}),a.toggleSidebar=function(){a.toggle=!a.toggle,b.put("toggle",a.toggle)},window.onresize=function(){a.$apply()}}]),app.controller("DashboardCtrl",["$scope","_users","_widgets","$filter",function(a,b,c,d){a.$parent.pageTitle="Dashboard",a.$parent.breadcrumb=[{text:"Home",href:null}],a.usersTotal=0,a.widgetsTotal=0,a.tblData={},a.tblData.users={title:"Users",headers:[{label:"ID",field:"id",sortable:!0},{label:"Name",field:"name",sortable:!0},{label:"Avatar",field:"gravatar",sortable:!1}],data:null,sortType:"name",sortReverse:!1,scrollable:!0},b.getAllUsers().then(function(b){a.usersTotal=b.length,b=b.map(function(a){return a.gravatar='<img src="'+a.gravatar+'" alt="'+a.name+'">',a.sref="userDetails({ id: "+a.id+"})",a}),a.tblData.users.data=b}),a.tblData.widgets={title:"Widgets",headers:[{label:"ID",field:"id",sortable:!0},{label:"Name",field:"name",sortable:!0},{label:"Color",field:"color",sortable:!0}],data:null,sortType:"name",sortReverse:!1,scrollable:!0},c.getAllWidgets().then(function(b){a.widgetsTotal=b.length,b=b.map(function(a){return a.price=d("currency")(a.price),a.melts=a.melts?"Yes":"No",a.sref="widgetDetails({ id: "+a.id+"})",a}),a.tblData.widgets.data=b})}]),app.controller("UsersCtrl",["$scope","_users",function(a,b){a.$parent.pageTitle="Users",a.$parent.breadcrumb=[{text:"Home",href:"dashboard"},{text:"Users",href:null}],a.tblData={title:"Users",headers:[{label:"ID",field:"id",sortable:!0},{label:"Name",field:"name",sortable:!0},{label:"Avatar",field:"gravatar",sortable:!1}],data:null,sortType:"name",sortReverse:!1},b.getAllUsers().then(function(b){b=b.map(function(a){return a.gravatar='<img src="'+a.gravatar+'" alt="'+a.name+'">',a.sref="userDetails({ id: "+a.id+"})",a}),a.tblData.data=b})}]),app.controller("UserDetailsCtrl",["$scope","_users","$stateParams",function(a,b,c){a.$parent.pageTitle="Users",a.$parent.breadcrumb=[{text:"Home",href:"dashboard"},{text:"Users",href:"users"}],b.getUser(c.id).then(function(b){a.user=b,a.$parent.breadcrumb.push({text:b.name,href:null})})}]),app.controller("WidgetsCtrl",["$scope","_widgets","$timeout","$filter",function(a,b,c,d){a.$parent.pageTitle="Widgets",a.$parent.breadcrumb=[{text:"Home",href:"dashboard"},{text:"Widgets",href:null}],a.tblData={title:"Widgets",headers:[{label:"ID",field:"id",sortable:!0},{label:"Name",field:"name",sortable:!0},{label:"Color",field:"color",sortable:!0},{label:"Price",field:"price",sortable:!0},{label:"Melts?",field:"melts",sortable:!0},{label:"Inventory",field:"inventory",sortable:!0}],data:null,sortType:"name",sortReverse:!1},b.getAllWidgets().then(function(b){b=b.map(function(a){return a.price=d("currency")(a.price),a.melts=a.melts?"Yes":"No",a.sref="widgetDetails({ id: "+a.id+"})",a}),a.tblData.data=b}),b.getColorOptions().then(function(b){a.colors=b}),a.processing=!1,a.resetForm=function(){a.widget={name:null,color:null,price:.01,melts:!1,inventory:0}},a.resetForm(),a.create=function(){return a.processing=!0,b.createWidget(a.widget).then(function(d){a.processing=!1,a.recordModified=!0,a.resetForm(),b.getAllWidgets().then(function(b){a.widgets=b}),c(function(){a.recordModified=!1},1e4)},function(){a.processing=!1,a.error=!0,c(function(){a.error=!1},1e4)}),!1}}]),app.controller("WidgetDetailsCtrl",["$scope","_widgets","$stateParams","$timeout",function(a,b,c,d){a.$parent.pageTitle="Widgets",a.$parent.breadcrumb=[{text:"Home",href:"dashboard"},{text:"Widgets",href:"widgets"}],b.getWidget(c.id).then(function(b){a.widget=b,a.widget.price=parseFloat(a.widget.price),a.$parent.breadcrumb.push({text:b.name,href:null})}),b.getColorOptions().then(function(b){a.colors=b}),a.processing=!1,a.save=function(){var c=angular.copy(a.widget);return delete c.id,a.processing=!0,b.editWidget(a.widget.id,c).then(function(b){a.processing=!1,a.recordModified=!0,d(function(){a.recordModified=!1},1e4)},function(){a.processing=!1,a.error=!0,d(function(){a.error=!1},1e4)}),!1}}]),app.directive("breadcrumb",["$state",function(a){return{restrict:"A",link:function(b,c,d){b.$watchCollection(function(){return b.breadcrumb},function(b){if(angular.isArray(b)){c.html("");var d=[];angular.forEach(b,function(b){null!=b.href?d.push('<a href="'+a.href(b.href)+'">'+b.text+"</a>"):d.push(b.text)}),c.html(d.join(" / "))}})}}}]),app.directive("animateValue",[function(){return{restrict:"A",scope:{total:"=animateValue"},link:function(a,b,c){a.$watch(function(){return a.total},function(a,c){angular.element({value:c}).animate({value:a},{duration:3e3,easing:"swing",step:function(){b.text(Math.ceil(this.value))}})})}}}]),app.directive("loading",[function(){return{restrict:"A",scope:{},templateUrl:"partials/directives/loading.html"}}]),app.directive("gridView",["$state",function(a){return{restrict:"A",templateUrl:"partials/directives/grid-view.html",scope:{config:"=gridView"}}}]),app.directive("widgetCreate",["_widgets",function(a){return{restrict:"A",templateUrl:"partials/directives/widget-create.html",replace:!0}}]),app.directive("backButton",["$state",function(a){return{restrict:"A",templateUrl:"partials/directives/back-button.html",replace:!0,scope:{},link:function(b,c,d){b.config=b.$eval(d.backButton),b.config.state=a.href(b.config.state)}}}]),app.filter("unique",[function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c=[],d=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){for(var b=!1,e=0;e<c.length;e++)if(angular.equals(d(c[e]),d(a))){b=!0;break}b||c.push(a)}),a=c}return a}}]);