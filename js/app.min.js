var app=angular.module("WidgetSpa",["ngRoute"]);app.constant("API_URL","http://spa.tglrw.com:4000"),app.run(["$rootScope",function(a){}]),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"partials/pages/dashboard.html",controller:"DashboardCtrl"}).when("/users",{templateUrl:"partials/pages/users.html",controller:"UsersCtrl"}).when("/users/:id",{templateUrl:"partials/pages/user-details.html",controller:"UserDetailsCtrl"}).when("/widgets",{templateUrl:"partials/pages/widgets.html",controller:"WidgetsCtrl"}).when("/widgets/:id",{templateUrl:"partials/pages/widget-details.html",controller:"WidgetDetailsCtrl"}).otherwise({redirectTo:"/"})}]),app.factory("_users",["$http","API_URL",function(a,b){var c={};return c.getAllUsers=function(){return a.get(b+"/users").then(function(a){return a.data})},c.getUser=function(c){return a.get(b+"/users/"+c).then(function(a){return a.data})},c}]),app.factory("_widgets",["$http","API_URL",function(a,b){var c={};return c.getAllWidgets=function(){return a.get(b+"/widgets").then(function(a){return a.data})},c.getWidget=function(c){return a.get(b+"/widgets/"+c).then(function(a){return a.data})},c.createWidget=function(c){return a.post(b+"/widgets",c).then(function(a){return a.data})},c.editWidget=function(c,d){return a.put(b+"/widgets/"+c,d).then(function(a){return a.data})},c.getColorOptions=function(){return a.get(b+"/widgets").then(function(a){var b=[];return a.data&&(angular.forEach(a.data,function(a){-1==b.indexOf(a.color)&&b.push(a.color)}),b=b.sort()),b})},c}]),app.controller("MainCtrl",["$scope",function(a){var b=new Date;a.year=b.getFullYear()}]),app.controller("DashboardCtrl",["$scope","_users","_widgets",function(a,b,c){b.getAllUsers().then(function(b){a.users=b}),c.getAllWidgets().then(function(b){a.widgets=b}),a.$parent.pageTitle="Dashboard",a.$parent.breadcrumb=[{text:"Home",href:null}]}]),app.controller("UsersCtrl",["$scope","_users",function(a,b){b.getAllUsers().then(function(b){a.users=b}),a.$parent.pageTitle="Users",a.$parent.breadcrumb=[{text:"Home",href:"/#/"},{text:"Users",href:null}]}]),app.controller("UserDetailsCtrl",["$scope","_users","$routeParams",function(a,b,c){a.$parent.pageTitle="Users",b.getUser(c.id).then(function(b){a.user=b,a.$parent.breadcrumb=[{text:"Home",href:"/#/"},{text:"Users",href:"/#/users"},{text:b.name,href:null}]})}]),app.controller("WidgetsCtrl",["$scope","_widgets","$timeout",function(a,b,c){a.$parent.pageTitle="Dashboard",a.$parent.breadcrumb=[{text:"Home",href:"/#/"},{text:"Widgets",href:null}],b.getAllWidgets().then(function(b){a.widgets=b}),b.getColorOptions().then(function(b){a.colors=b}),a.processing=!1,a.resetForm=function(){a.widget={name:null,color:null,price:.01,melts:!1,inventory:0}},a.resetForm(),a.create=function(){return a.processing=!0,b.createWidget(a.widget).then(function(d){a.processing=!1,a.recordModified=!0,a.resetForm(),b.getAllWidgets().then(function(b){a.widgets=b}),c(function(){a.recordModified=!1},1e4)},function(){a.processing=!1,a.error=!0,c(function(){a.error=!1},1e4)}),!1}}]),app.controller("WidgetDetailsCtrl",["$scope","_widgets","$routeParams","$timeout",function(a,b,c,d){a.$parent.pageTitle="Widgets",b.getWidget(c.id).then(function(b){a.widget=b,a.widget.price=parseFloat(a.widget.price),a.$parent.breadcrumb=[{text:"Home",href:"/#/"},{text:"Widgets",href:"/#/widgets"},{text:b.name,href:null}]}),b.getColorOptions().then(function(b){a.colors=b}),a.processing=!1,a.save=function(){var c=angular.copy(a.widget);return delete c.id,a.processing=!0,b.editWidget(a.widget.id,c).then(function(b){a.processing=!1,a.recordModified=!0,d(function(){a.recordModified=!1},1e4)},function(){a.processing=!1,a.error=!0,d(function(){a.error=!1},1e4)}),!1}}]),app.directive("breadcrumb",[function(){return{restrict:"A",link:function(a,b,c){a.$watch(function(){return a.breadcrumb},function(a){if(angular.isArray(a)){b.html("");var c=[];angular.forEach(a,function(a){null!=a.href?c.push('<a href="'+a.href+'">'+a.text+"</a>"):c.push(a.text)}),b.html(c.join(" / "))}})}}}]),app.directive("loading",[function(){return{restrict:"A",scope:{},templateUrl:"partials/directives/loading.html"}}]),app.directive("listUsers",[function(){return{restrict:"A",templateUrl:"partials/directives/list-users.html",replace:!0,scope:{users:"=listUsers"},controller:function(a,b){a.go=function(a){b.location.href="/#/users/"+a}}}}]),app.directive("listWidgets",[function(){return{restrict:"A",templateUrl:"partials/directives/list-widgets.html",replace:!0,scope:{widgets:"=listWidgets",simpleView:"=simpleView"},controller:function(a,b){a.go=function(a){b.location.href="/#/widgets/"+a}}}}]),app.directive("widgetCreate",["_widgets",function(a){return{restrict:"A",templateUrl:"partials/directives/widget-create.html",replace:!0}}]),app.directive("backButton",[function(){return{restrict:"A",templateUrl:"partials/directives/back-button.html",replace:!0,scope:{},link:function(a,b,c){a.config=a.$eval(c.backButton)}}}]),app.filter("unique",[function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c=[],d=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){for(var b=!1,e=0;e<c.length;e++)if(angular.equals(d(c[e]),d(a))){b=!0;break}b||c.push(a)}),a=c}return a}}]);